<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<title>服务记录详情</title>
	    <link rel="stylesheet" href="../css/personal/22.css">
	    
	</head>
	<body>
		<div class="container"></div>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/common.js"></script>
		<script type="text/javascript" src="../js/layer/layer.js"></script>
	    <script>
	    	sessionArr = getCookie('sessionArr');
	    	order_id=$_GET['id'];
	    	state=$_GET['state'];
	    	if(!sessionArr){
	    		layer.msg('该用户登陆数据已过期，请重新登陆',{time:1000},function(){
	    			window.parent.tologin();
	    		});
	    	}else{
	    		ss=JSON.parse(sessionArr).session;
	    	}
	    	layer.load(2);
	    	$.ajax({
		    	type:'POST',
		    	url:commonUrl + 'api/stj/service_order/order_info'+versioninfo,
		    	data:{
		    		'ss':ss,
		    		'order_id':order_id
		    	},
		    	success:function(data){
		    		layer.closeAll();
//		    		console.log(data);
                    if(data.code == 1){
                    	service_type=data.result.service_type; //服务类型
                    	service_option=data.result.service_option;  //已选服务
                    	intend_time=data.result.intend_time;   //服务时间
                    	created_at=data.result.created_at;  //申请时间
                    	service_content=data.result.service_content;  //服务描述
                    	manage_time=data.result.manage_time;   //反馈时间
                    	manage_name=data.result.manage_name;   //反馈人员
                    	manage_content=data.result.manage_content; //反馈内容
                    	if(!service_content){
                    		service_content="暂无";
                    	}
                    	if(!manage_content){
                    		manage_content="暂无";
                    	}
                    	html='';
                    	html+='<div class="apply">';
                    	html+='	<div class="return"><span>服务类型：</span>'+service_type+'</div>';
                    	html+='	<div class="who"><span>已选服务：</span>'+service_option+'</div>';
                    	html+='	<div class="clearfix"></div>';
                    	html+='</div>';
                    	html+='<div class="apply">';
                    	if(service_type=="预约挂号"||service_type=="住院治疗"){
                    		html+='	<div class="return"><span>服务时间：</span>'+intend_time.slice(0,10)+'</div>';
                    	}
                    	
                    	html+='	<div class="who"><span>申请时间：</span>'+created_at+'</div>';
                    	html+='	<div class="clearfix"></div>';
                    	html+='</div>';
                    	html+='<div class="apply describe">';
                    	html+='	<span>描述：</span>'+service_content;
                    	html+='</div>';
                    	if(state=='1'){
                    		html+='<div class="apply">';
	                    	html+='	<div class="return"><span>反馈时间：</span>'+manage_time+'</div>';
	                    	html+='	<span class="who">反馈人员：'+manage_name+'</span>';
	                    	html+='	<div class="clearfix"></div>';
	                    	html+='</div>';
	                    	html+='<div class="apply describe">';
	                    	html+='	<span>反馈：</span>'+manage_content;
					    	html+='</div>';
                    	}
				    	$('.container').html(html);
				    	setIframeHeight();
				    	//iframe自适应高度
						function getDocHeight(doc) {
						    doc = doc || document;
						    var body = doc.body, html = doc.documentElement;
						    var height = Math.max( body.scrollHeight, body.offsetHeight, 
						        html.clientHeight, html.scrollHeight, html.offsetHeight );
						    return height;
						}
						function setIframeHeight() {
						    var ifrm = window.parent.document.getElementById("ifrm");
						    var doc = ifrm.contentDocument? ifrm.contentDocument: 
						        ifrm.contentWindow.document;
						    ifrm.style.visibility = 'hidden';
						    ifrm.style.height = "10px"; 
						    ifrm.style.height = getDocHeight( doc ) + "px";
						    ifrm.style.visibility = 'visible';
						}
                  	}else if(data.code=='1011'){
                  		layer.msg('该用户登陆数据已过期，请重新登陆',{time:1000},function(){
                  			window.parent.removec();
                  			window.parent.tologin();
                  		});
                  	}else{
                  		layer.msg(data.msg);
                  	}
                }
            });
	    </script>
	</body>
</html>
